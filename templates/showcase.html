<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成果展示 - Python Playground</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <h1>Python Playground</h1>
        <p>成果展示 - 各組程式碼與執行結果</p>
        <nav>
            <a href="/">練習區</a>
            <a href="/showcase" class="active">成果展示</a>
            <a href="/admin">管理者</a>
        </nav>
    </header>

    <div class="showcase-controls">
        <button class="btn btn-primary" onclick="refreshData()">重新整理</button>
        <button class="btn btn-secondary" onclick="toggleAutoRefresh()">
            <span id="auto-refresh-status">啟用自動更新</span>
        </button>
    </div>

    <main class="showcase-container">
        {% for group_id in range(1, 7) %}
        <div class="showcase-card" id="showcase-{{ group_id }}">
            <div class="showcase-header">
                <h2>第 {{ group_id }} 組</h2>
                <span class="last-run" id="showcase-time-{{ group_id }}">
                    {% if groups_data[group_id].last_run %}
                    {{ groups_data[group_id].last_run }}
                    {% else %}
                    尚未執行
                    {% endif %}
                </span>
            </div>

            <div class="showcase-task">
                <strong>任務：</strong>
                <span id="showcase-task-{{ group_id }}">{{ groups_data[group_id].task }}</span>
            </div>

            <div class="showcase-content">
                <div class="showcase-code">
                    <h3>程式碼</h3>
                    <pre id="showcase-code-{{ group_id }}">{{ groups_data[group_id].code if groups_data[group_id].code else '尚未撰寫程式碼' }}</pre>
                </div>
                <div class="showcase-output">
                    <h3>執行結果</h3>
                    <pre id="showcase-output-{{ group_id }}">{{ groups_data[group_id].output if groups_data[group_id].output else '尚未執行' }}</pre>
                </div>
            </div>
        </div>
        {% endfor %}
    </main>

    <script>
        let autoRefreshInterval = null;
        let isAutoRefresh = false;

        function refreshData() {
            fetch('/get_all_data')
                .then(response => response.json())
                .then(data => {
                    for (let groupId = 1; groupId <= 6; groupId++) {
                        const group = data[groupId];
                        document.getElementById(`showcase-code-${groupId}`).textContent =
                            group.code || '尚未撰寫程式碼';
                        document.getElementById(`showcase-output-${groupId}`).textContent =
                            group.output || '尚未執行';
                        document.getElementById(`showcase-task-${groupId}`).textContent =
                            group.task || '無指派任務';
                        document.getElementById(`showcase-time-${groupId}`).textContent =
                            group.last_run || '尚未執行';
                    }
                });
        }

        function toggleAutoRefresh() {
            isAutoRefresh = !isAutoRefresh;
            const statusEl = document.getElementById('auto-refresh-status');

            if (isAutoRefresh) {
                autoRefreshInterval = setInterval(refreshData, 3000);
                statusEl.textContent = '停止自動更新';
            } else {
                clearInterval(autoRefreshInterval);
                statusEl.textContent = '啟用自動更新';
            }
        }
    </script>
</body>
</html>
