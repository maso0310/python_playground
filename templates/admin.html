<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理者 - Python Playground</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <div class="header-left">
            <h1>Python Playground</h1>
            <p>管理者頁面 - 任務指派</p>
        </div>
        <nav>
            <a href="/python_playground/">練習區</a>
            <a href="/python_playground/admin" class="active">管理者</a>
        </nav>
    </header>

    <main class="admin-container">
        <section class="admin-section">
            <h2>快速指派相同任務給所有組別</h2>
            <div class="quick-assign">
                <textarea id="quick-task" placeholder="輸入要指派給所有組別的任務..."></textarea>
                <button class="btn btn-primary" onclick="assignToAll()">指派給所有組別</button>
            </div>
        </section>

        <section class="admin-section">
            <h2>預設任務範本</h2>
            <div class="task-templates">
                <button class="btn btn-template" onclick="useTemplate(1)">遊戲挑戰</button>
                <button class="btn btn-template" onclick="useTemplate(2)">密碼與加密</button>
                <button class="btn btn-template" onclick="useTemplate(3)">資料分析</button>
                <button class="btn btn-template" onclick="useTemplate(4)">圖形繪製</button>
                <button class="btn btn-template" onclick="useTemplate(5)">模擬實驗</button>
                <button class="btn btn-template" onclick="useTemplate(6)">演算法挑戰</button>
            </div>
        </section>

        <section class="admin-section">
            <h2>個別組別任務指派</h2>
            <div class="individual-tasks">
                {% for group_id in range(1, 7) %}
                <div class="task-card">
                    <div class="task-header">
                        <h3>第 {{ group_id }} 組</h3>
                        <button class="btn btn-small btn-save" onclick="saveTask({{ group_id }})">儲存</button>
                    </div>
                    <textarea id="admin-task-{{ group_id }}" class="task-input">{{ groups_data[group_id].task }}</textarea>
                    <div class="task-status">
                        <span>程式碼: {{ '已撰寫' if groups_data[group_id].code else '尚未撰寫' }}</span>
                        <span>執行: {{ groups_data[group_id].last_run if groups_data[group_id].last_run else '尚未執行' }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <section class="admin-section">
            <h2>批次操作</h2>
            <div class="batch-actions">
                <button class="btn btn-danger" onclick="clearAllGroups()">清除所有組別的程式碼</button>
                <button class="btn btn-primary" onclick="saveAllTasks()">儲存所有任務</button>
            </div>
        </section>
    </main>

    <script>
        const taskTemplates = {
            // 遊戲挑戰
            1: {
                1: "【猜數字】寫一個猜數字遊戲，電腦隨機產生 1-100 的數字，玩家猜測後給予「太大」或「太小」的提示，直到猜中為止",
                2: "【剪刀石頭布】寫一個剪刀石頭布遊戲，玩家與電腦對戰，進行 5 局比賽並統計勝負",
                3: "【骰子大戰】寫一個雙人骰子遊戲，兩位玩家各擲 3 顆骰子，點數總和較大者獲勝",
                4: "【21點】寫一個簡化版 21 點遊戲，玩家可以選擇「要牌」或「停牌」，超過 21 點就輸了",
                5: "【終極密碼】寫一個終極密碼遊戲，設定 1-100 的範圍，每次猜測後縮小範圍，猜中炸彈數字的人輸",
                6: "【賽馬遊戲】寫一個文字版賽馬遊戲，模擬 5 匹馬比賽，每回合隨機前進 1-3 步，最先到達終點者獲勝"
            },
            // 密碼與加密
            2: {
                1: "【密碼產生器】產生一組 12 位的強密碼，包含大小寫字母、數字和特殊符號",
                2: "【凱薩密碼】實作凱薩密碼加密與解密，可以指定位移數量",
                3: "【摩斯密碼】將英文句子轉換成摩斯密碼，也可以將摩斯密碼轉回英文",
                4: "【密碼強度檢測】分析密碼強度，根據長度、字元種類等給予評分（弱/中/強）",
                5: "【簡易雜湊】實作一個簡單的雜湊函式，將任意字串轉換成固定長度的數字",
                6: "【隱寫術】將秘密訊息藏在一段普通文字中（例如每個單字的首字母組成秘密訊息）"
            },
            // 資料分析
            3: {
                1: "【成績統計】分析一個班級的成績資料，計算平均、最高、最低分，並統計各等第人數",
                2: "【詞頻統計】分析一段英文文章，統計每個單字出現的次數，找出前 10 個最常出現的字",
                3: "【氣溫分析】分析一週的氣溫資料，找出最熱和最冷的日子，計算溫差",
                4: "【銷售報表】分析一間商店的銷售資料，計算各商品的銷售額和利潤",
                5: "【問卷分析】分析一份問卷調查結果，統計各選項的百分比並製作長條圖（用文字符號）",
                6: "【股票分析】分析一支股票 30 天的價格，計算移動平均線並找出買賣訊號"
            },
            // 圖形繪製
            4: {
                1: "【聖誕樹】用 * 符號畫出一棵聖誕樹，可以指定樹的高度",
                2: "【菱形圖案】用 * 符號畫出一個菱形，可以指定大小",
                3: "【空心方形】用 * 符號畫出一個空心的方形，可以指定邊長",
                4: "【數字金字塔】畫出由數字組成的金字塔（1, 12, 123, 1234...）",
                5: "【螺旋數字】畫出一個 N x N 的螺旋數字方陣",
                6: "【Pascal三角形】畫出巴斯卡三角形的前 N 行"
            },
            // 模擬實驗
            5: {
                1: "【擲硬幣實驗】模擬擲硬幣 10000 次，驗證正反面機率是否接近 50%",
                2: "【生日悖論】模擬 23 人的房間中，至少兩人同一天生日的機率（執行 1000 次實驗）",
                3: "【蒙地卡羅求圓周率】用隨機投點的方式估算圓周率的值",
                4: "【醉漢走路】模擬一個人隨機往上下左右走 1000 步，計算最後離原點的距離",
                5: "【排隊理論】模擬一個銀行窗口，顧客隨機到達，計算平均等待時間",
                6: "【傳染病模擬】模擬一個簡單的傳染病擴散模型（SIR模型），觀察感染人數變化"
            },
            // 演算法挑戰
            6: {
                1: "【河內塔】解決河內塔問題，印出 N 個圓盤的完整移動步驟",
                2: "【八皇后】找出在 8x8 棋盤上放置 8 個皇后使其互不攻擊的其中一種解法",
                3: "【迷宮求解】給定一個迷宮（用二維陣列表示），找出從起點到終點的路徑",
                4: "【背包問題】給定物品的重量和價值，在背包容量限制下找出最大價值的組合",
                5: "【數獨求解】寫一個程式解決數獨問題",
                6: "【最短路徑】實作 Dijkstra 演算法，找出圖中兩點之間的最短路徑"
            }
        };

        function saveTask(groupId) {
            const task = document.getElementById(`admin-task-${groupId}`).value;
            fetch(`/python_playground/task/${groupId}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({task: task})
            })
            .then(response => response.json())
            .then(data => {
                alert(`第 ${groupId} 組任務已更新！`);
            });
        }

        function saveAllTasks() {
            const tasks = {};
            for (let i = 1; i <= 6; i++) {
                tasks[i] = document.getElementById(`admin-task-${i}`).value;
            }
            fetch('/python_playground/all_tasks', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({tasks: tasks})
            })
            .then(response => response.json())
            .then(data => {
                alert('所有任務已更新！');
            });
        }

        function assignToAll() {
            const task = document.getElementById('quick-task').value;
            if (!task.trim()) {
                alert('請輸入任務內容！');
                return;
            }
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`admin-task-${i}`).value = task;
            }
            saveAllTasks();
        }

        function useTemplate(templateId) {
            const template = taskTemplates[templateId];
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`admin-task-${i}`).value = template[i];
            }
            alert('已載入任務範本，請按「儲存所有任務」確認！');
        }

        function clearAllGroups() {
            if (!confirm('確定要清除所有組別的程式碼嗎？')) return;

            const promises = [];
            for (let i = 1; i <= 6; i++) {
                promises.push(
                    fetch(`/python_playground/clear/${i}`, {method: 'POST'})
                );
            }
            Promise.all(promises).then(() => {
                alert('所有組別已清除！');
                location.reload();
            });
        }
    </script>
</body>
</html>
